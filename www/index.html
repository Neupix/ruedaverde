<!doctype html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Rueda Verde</title>

	<link rel="stylesheet" href="lungo/lungo.css">
	<link rel="stylesheet" href="lungo/lungo.icon.css">
	<link rel="stylesheet" href="lungo/lungo.theme.css">

	<script src="lungo/quo.js"></script>
	<script src="lungo/lungo.js"></script>

    <style>
        body > section > header{background:#00ac4e;-webkit-box-shadow: inset 0 -1px #008039, 0 1px rgba(0,0,0,.1);-moz-box-shadow: inset 0 -1px #008039, 0 1px rgba(0,0,0,.1);box-shadow: inset 0 -1px #008039, 0 1px rgba(0,0,0,.1)}
        body > section > header .title{text-shadow: 0 .1em #008039;}
        section header > nav.on-right a, section header > nav.on-right button {text-shadow: 0 .1em #008039;}
        section header > nav:not(.on-right) a, section header > nav:not(.on-right) button {color:#008039;text-shadow:0 0.1em #0ac45e;}
        img{max-width: 100%}
    </style>
</head>
<body>

<section id="main_section" class="show" data-tansition="slide" data-pull="normal">

    <header data-title="Rueda Verde">
        <nav>
            <a href="#" data-view-menu="options" data-icon="menu"></a>
        </nav>

        <!--
        <nav class="on-right">
            <button data-view-aside="features" data-icon="comment"></button>
        </nav>
        -->

    </header>

    <nav id="options" data-control="menu" class="icons">
        <a href="#" data-title="Rueda Verde" data-view-article="article_home" data-icon="home" class="active">Inicio</a>
        <a href="#" data-title="Eventos" data-view-article="article_eventos" data-icon="calendar">Eventos</a>
        <a href="#" data-title="Noticias" data-view-article="article_noticias" data-icon="bullhorn">Noticias</a>
        <a href="#" data-title="Guías" data-view-article="article_guias" data-icon="group">Guías</a>
    </nav>

    <article id="article_home" class="active list scroll indented">
            <ul>
                <li data-icon="calendar" data-view-article="article_eventos" data-title="Eventos">
                    <strong>Ver eventos</strong>
                </li>

                <li data-icon="bullhorn" data-view-article="article_noticias" data-title="Noticias">
                    <strong>Ver noticias</strong>
                </li>

                <li data-icon="group" data-view-article="article_guias" data-title="Guías">
                    <strong>Conocer a los guías</strong>
                </li>

                <button id="facebookShare" class="anchor margin-bottom" data-icon="facebook" data-label="Compartir en facebook"></button>

            </ul>
    </article><!-- home -->

    <article id="article_eventos" class="list indented scroll">
    	<ul id="showEventos">
            <li>
                <strong>No hay eventos registrados</strong>
                <small>Desplaza hacia abajo para actualizar</small>          
            </li>  
        </ul>
    </article><!-- eventos -->

    <article id="article_noticias" class="list indented scroll">
    	<ul id="showNoticias">
            <li>
                <strong>No hay noticias registradas</strong>
                <small>Desplaza hacia abajo para actualizar</small>
            </li>
        </ul>
    </article><!-- noticias -->

    <article id="article_guias" class="list indented scroll">

        <ul>
            <li class="big">
                <img src="img/guias/guias.jpg">
            </li>

            <li>Los guías donan su tiempo a Rueda Verde, y trabajan en pro de tu seguridad. Conócelos.</li>

            <li class="thumb big">
                <img src="img/guias/andrea.jpg" />
                <div>
                    <strong>Andrea</strong>
                </div>
            </li>

            <li class="thumb big">
                <img src="img/guias/luisfelipe.jpg" />
                <div>
                    <strong>Luis Felipe</strong>
                </div>
            </li>

            <li class="thumb big">
                <img src="img/guias/julio.jpg" />
                <div>
                    <strong>Julio Morales</strong>
                </div>
            </li>

            <li class="thumb big">
                <img src="img/guias/dania.jpg" />
                <div>
                    <strong>Dania</strong>
                </div>
            </li>

            <li class="thumb big">
                <img src="img/guias/edd.jpg" />
                <div>
                    <strong>Edd</strong>
                </div>
            </li>

            <li class="thumb big">
                <img src="img/guias/fatho.jpg" />
                <div>
                    <strong>Fatho</strong>
                </div>
            </li>

            <li class="thumb big">
                <img src="img/guias/raquel.jpg" />
                <div>
                    <strong>Raquel</strong>
                </div>
            </li>

            <li class="thumb big">
                <img src="img/guias/suzie.jpg" />
                <div>
                    <strong>Suzie</strong>
                </div>
            </li>

            <li class="thumb big">
                <img src="img/guias/roberto.jpg" />
                <div>
                    <strong>Roberto</strong>
                </div>
            </li>

            <li class="thumb big">
                <img src="img/guias/rudy.jpg" />
                <div>
                    <strong>Rudy</strong>
                </div>
            </li>

            <li class="thumb big">
                <img src="img/guias/tannia.jpg" />
                <div>
                    <strong>Tannia</strong>
                </div>
            </li>

            <li class="thumb big">
                <img src="img/guias/gustavo.jpg" />
                <div>
                    <strong>Gustavo</strong>
                </div>
            </li>

            <li class="thumb big">
                <img src="img/guias/cesar.jpg" />
                <div>
                    <strong>Cesar</strong>
                </div>
            </li>
        <br><br>
        </ul>

    </article><!-- guias -->

</section>

<script type="text/javascript" src="phonegap.js"></script>
<script>
//document.addEventListener("deviceready", onDeviceReady, false);
//function onDeviceReady() {

	Lungo.init({});

    var pull_eventos = new Lungo.Element.Pull('#article_eventos', {
        onPull: "Desliza hacia abajo para actualizar",      //Text on pulling
        onRelease: "Suelta para actualizar",//Text on releasing
        onRefresh: "Actualizando...",          //Text on refreshing
        callback: function() {               //Action on refresh
            updateCalendar();
            
        }
    });

    var pull_noticias = new Lungo.Element.Pull('#article_noticias', {
        onPull: "Desliza hacia abajo para actualizar",      //Text on pulling
        onRelease: "Suelta para actualizar",//Text on releasing
        onRefresh: "Actualizando...",          //Text on refreshing
        callback: function() {               //Action on refresh
            updateNoticias();
            
        }
    });

    var calendar = "";
    var ev = [];
    var updateCalendar = function() {
        var getCalendar = $$.json('http://javierbyte.com/app/ruedaverde/api/get_recent_posts/', {post_type:"evento"},
            function(){
                calendar = JSON.parse(getCalendar.response).posts;
                $$('#showEventos').html('<li class="anchor contrast">Da clic en un evento para agregarlo al calendario</li>');
                for(i=0;i<calendar.length;i++) {

                    ev[i] = new Object();
                    ev[i].year = parseInt(calendar[i].custom_fields.fecha[0].slice(0,4),10);
                    ev[i].day = parseInt(calendar[i].custom_fields.fecha[0].slice(6,8),10);
                    ev[i].month = parseInt(calendar[i].custom_fields.fecha[0].slice(4,6),10);
                    ev[i].hour = parseInt(calendar[i].custom_fields.hora[0],10);
                    ev[i].description = calendar[i].custom_fields.descripcion[0];
                    ev[i].place = calendar[i].custom_fields.lugar[0];
                    ev[i].title =  calendar[i].title;

                    var fecha = ev[i].day + ' - ' + ev[i].month + ' - ' + ev[i].year;
                    $$('#showEventos').prepend('<li class="evento" data-evid="' + i + '"><strong class="text bold">' + ev[i].title + '</strong><span class="text tiny">' + fecha + ' - ' + ev[i].hour + ':00</span><small>' + ev[i].description + '<small></li>');
                }
                pull_eventos.hide();
            }
        );
    };

    var updateNoticias = function() {
        var noticias = "";
        var getNoticias = $$.json('http://javierbyte.com/app/ruedaverde/api/get_recent_posts/', {post_type:"post"},
            function(){
                noticias = JSON.parse(getNoticias.response).posts;
                $$('#showNoticias').html('');                
                for(i=0;i<noticias.length;i++) {
                    $$('#showNoticias').prepend('<li><strong class="text bold">' + noticias[i].title + '</strong><span class="text tiny">' + noticias[i].custom_fields.texto[0]+ '</span><br><img src="' + noticias[i].thumbnail + '">');
                }
                pull_noticias.hide();
            }
        );
    };

    $$('.evento').tap(function(){
        var evid = $$(this).data('evid');
        var startDate = new Date(ev[i].year,ev[i].month-1,ev[i].day,ev[i].hour,0,0,0,0); // beware: month 0 = january, 11 = december
        var endDate = new Date(ev[i].year,ev[i].month-1,ev[i].day,ev[i].hour+2,0,0,0,0);
        var title = ev[i].title;
        var location = ev[i].place;
        var notes = "";
        var success = function(message) { alert("Success: " + JSON.stringify(message)); };
        var error = function(message) { alert("Error: " + message); };

        window.plugins.calendar.createEvent(title,location,notes,startDate,endDate,success,error);
    });

    $$('#facebookShare').tap(function(){
        window.plugins.socialsharing.shareViaFacebook('Prueba la nueva aplicación de rueda verde en http://www.ruedaverde.org', null, null, console.log('share ok'), function(errormsg){alert(errormsg)})
    });

    updateCalendar();
    updateNoticias();
//}
</script>
</body>
</html>