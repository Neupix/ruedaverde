<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Rueda Verde</title>

	<link rel="stylesheet" href="ui/fontawesome/css/font-awesome.min.css">
	<link rel="stylesheet" href="ui/ui.css">
	<link rel="stylesheet" href="style.css">

	<script src="js/jquery-2.1.0.min.js"></script>
	<script src="js/fastclick.js"></script>
</head>
<body>

<section id="home">
	<header>
		<div class="title">Inicio</div>

		<nav class="left">
			<a open-nav><i class="fa fa-bars"></i></a>
		</nav>
	</header>

	<article id="home_menu" data-title="Inicio">
		<img src="img/ui/logo.png" class="logo" alt="">

		<a data-article="home_eventos" class="button">
			<i class="fa fa-calendar"></i> Eventos
			<small id="home_show_eventos"></small>
		</a>
		<a data-article="home_noticias" class="button">
			<i class="fa fa-bullhorn"></i> Noticias
			<small id="home_show_noticias"></small>
		</a>
		<a data-article="home_guias" class="button">
			<li class="fa fa-group"></li> Conocer a los guías
		</a>

		<aside class="columns">
			<aside class="d6">
				<a class="button" onclick="share('https://play.google.com/store/apps/details?id=com.neupix.ruedaverde')"><i class="fa fa-facebook"></i> Compartir</a>
			</aside>
	
			<aside class="d6">
				<a href="mailto:contacto@ruedaverde.org" class="button"><i class="fa fa-comment"></i> Contacto</a>
			</aside>
		</aside>
	</article><!-- home_menu -->

	<article id="home_eventos" data-title="Eventos">
		<aside>
			No hay eventos disponibles.
		</aside>
	</article><!-- home_eventos -->

	<article id="home_noticias" data-title="Noticias">
		<aside>
			No se han podido cargar las noticias.
		</aside>
	</article><!-- home_noticias -->

	<article id="home_guias" data-title="Guías">
			<div class="p0">
				<img src="img/guias/guias.jpg">
			</div>

			<div>Los guías donan su tiempo a Rueda Verde, y trabajan en pro de tu seguridad. Conócelos.</div>

			<div class="thumb">
				<img src="img/guias/andrea.jpg" />
				<aside>
					<h1>Andrea</h1>
					<small>Guía de Rueda Verde.</small>
				</aside>
			</div>

			<div class="thumb">
				<img src="img/guias/luisfelipe.jpg" />
				<aside>
					<h1>Luis Felipe</h1>
					<small>Guía de Rueda Verde.</small>
				</aside>
			</div>

			<div class="thumb">
				<img src="img/guias/julio.jpg" />
				<aside>
					<h1>Julio Morales</h1>
					<small>Guía de Rueda Verde.</small>
				</aside>
			</div>

			<div class="thumb">
				<img src="img/guias/dania.jpg" />
				<aside>
					<h1>Dania</h1>
					<small>Guía de Rueda Verde.</small>
				</aside>
			</div>

			<div class="thumb">
				<img src="img/guias/edd.jpg" />
				<aside>
					<h1>Edd</h1>
					<small>Guía de Rueda Verde.</small>
				</aside>
			</div>

			<div class="thumb">
				<img src="img/guias/fatho.jpg" />
				<aside>
					<h1>Fatho</h1>
					<small>Guía de Rueda Verde.</small>
				</aside>
			</div>

			<div class="thumb">
				<img src="img/guias/raquel.jpg" />
				<aside>
					<h1>Raquel</h1>
					<small>Guía de Rueda Verde.</small>
				</aside>
			</div>

			<div class="thumb">
				<img src="img/guias/suzie.jpg" />
				<aside>
					<h1>Suzie</h1>
					<small>Guía de Rueda Verde.</small>
				</aside>
			</div>

			<div class="thumb">
				<img src="img/guias/roberto.jpg" />
				<aside>
					<h1>Roberto</h1>
					<small>Guía de Rueda Verde.</small>
				</aside>
			</div>

			<div class="thumb">
				<img src="img/guias/rudy.jpg" />
				<aside>
					<h1>Rudy</h1>
					<small>Guía de Rueda Verde.</small>
				</aside>
			</div>

			<div class="thumb">
				<img src="img/guias/tannia.jpg" />
				<aside>
					<h1>Tannia</h1>
					<small>Guía de Rueda Verde.</small>
				</aside>
			</div>

			<div class="thumb">
				<img src="img/guias/gustavo.jpg" />
				<aside>
					<h1>Gustavo</h1>
					<small>Guía de Rueda Verde.</small>
				</aside>
			</div>

			<div class="thumb">
				<img src="img/guias/cesar.jpg" />
				<aside>
					<h1>Cesar</h1>
					<small>Guía de Rueda Verde.</small>
				</aside>
			</div>

			<div class="thumb">
				<img src="img/guias/gesu.jpg" />
				<aside>
					<h1>Gesu</h1>
					<small>Guía de Rueda Verde.</small>
				</aside>
			</div>
	</article>

	<article id="home_acercade" data-title="Acerca de">

		<img src="img/ui/neupix.png" class="logo" alt="">

		<aside>
			App y página web desarrollados por <a href="#" onclick="window.open('http://www.neupix.com', '_system');">Neupix</a> para Rueda Verde.
			<br><br>

			<li class="fa fa-envelope"></li> info@neupix.com <br>
			<li class="fa fa-phone"></li> (668)1750896 <br>
			<li class="fa fa-globe"></li> <a href="#" onclick="window.open('http://www.neupix.com', '_system');">www.neupix.com</a> <br>
		</aside>
	</article>

</section><!-- home -->

<section id="mapa">
	<header>
		<data class="title">Mapa</data>
	
		<nav class="left">
			<a back><i class="fa fa-chevron-left"></i></a>
		</nav>
	</header>

	<article id="noticia_inicio" data-title="Mapa">
		<img id="lemap">
	</article><!-- mapa_inicio -->
	
</section><!-- mapa -->

<nav id="side">
	<a data-article="home_menu"><li class="fa fa-home"></li> Inicio</a>
	<a data-article="home_eventos"><li class="fa fa-calendar"></li> Eventos</a>
	<a data-article="home_noticias"><li class="fa fa-bullhorn"></li> Noticias</a>
	<a data-article="home_guias"><li class="fa fa-group"></li> Guías</a>
	<a href="mailto:contacto@ruedaverde.org"><li class="fa fa-comment"></li> Contáctanos</a>
	<a data-article="home_acercade"><li class="fa fa-info-circle"></li> Acerca de esta app</a>
</nav>

<script type="text/javascript" src="phonegap.js"></script>
<script src="js/app.js"></script>

<script>

	function share(url) {
		window.plugins.socialsharing.shareViaFacebook('Message via Facebook', null, url, console.log('share ok'), function(errormsg){alert(errormsg)})
	}

	var updateNoticias = function() {
		var noticiasBuffer = "";
		$.ajax({
			url: "http://javierbyte.com/app/ruedaverde/api/get_recent_posts/?post_type=post",
			jsonp: "callback",
			dataType: "jsonp",
			success: function( res ) {
				$('#home_show_noticias').html(res.posts[0].title);
				for(x in res.posts) {
					noticiasBuffer += '<div class="p0"><img src="' + res.posts[x].thumbnail + '"><aside><h1>' + res.posts[x].title + '</h1>' + res.posts[x].custom_fields.texto[0].replace(/\n/g, '<br />') + '</aside></div>';
				}
				console.log( res.posts[0].custom_fields.texto[0])
				$('#home_noticias').html(noticiasBuffer);
			}
		});
	}();

	var evento = [];
	var updateEventos = function() {
		var eventosBuffer = "";
		$.ajax({
			url: "http://javierbyte.com/app/ruedaverde/api/get_recent_posts/?post_type=evento",
			jsonp: "callback",
			dataType: "jsonp",
			success: function( res ) {
				$('#home_show_eventos').html(res.posts[0].title + ' [' + res.posts[0].custom_fields.fecha[0] + ']');

				for(x in res.posts) {
					evento[x] = new Object();
					evento[x].title = res.posts[x].title;
					evento[x].descripcion = res.posts[x].custom_fields.descripcion[0];
					evento[x].fecha = res.posts[x].custom_fields.fecha[0];
						evento[x].yy = evento[x].fecha.split('-')[0];
						evento[x].mm = evento[x].fecha.split('-')[1];
						evento[x].dd = evento[x].fecha.split('-')[2];
					evento[x].hora = res.posts[x].custom_fields.hora[0];
					evento[x].ruta = res.posts[x].custom_fields.ruta[0];
					evento[x].lugar = res.posts[x].custom_fields.lugar[0];

					eventosBuffer += '<div><h1>' + evento[x].title + '</h1><b>Descripción</b> ' + evento[x].descripcion + '<br><b>Fecha</b> ' + evento[x].fecha + ' ' + evento[x].hora + ':00';
					
					//adding the google map
					if(evento[x].ruta != "") {
						eventosBuffer += '<a data-mapa="' + x + '"><img src="http://maps.googleapis.com/maps/api/staticmap?size=480x320&path=weight:5%7Ccolor:0x000000%7Cenc:' + evento[x].ruta + '&sensor=true"/></a></li>';
					}

					eventosBuffer += '<a data-evento="' + x + '" class="button">Agregar al calendario</a></li></div>';
				}
				$('#home_eventos').html(eventosBuffer);
				listenEventos();
			}
		});
	}();

	function listenEventos() {
		$('*[data-evento]').on('click', function() {
			var i = $(this).attr('data-evento');
			var startDate = new Date(evento[i].yy,evento[i].mm-1,evento[i].dd,evento[i].hora,0,0,0,0);
			var endDate = new Date(evento[i].yy,evento[i].mm-1,evento[i].dd,evento[i].hora+2,0,0,0,0);
			var title = evento[i].title;
			var location = evento[i].lugar;
			var success = function(message) { alert("Evento agregado con éxito a tu calendario, ¡te esperamos!"); };
			var error = function(message) { alert("Error: " + message); };
			window.plugins.calendar.findEvent(title,location,"",startDate,endDate,function(message) {
				if(message.length) {
					alert('Ya agregaste el evento al calendario, ¡gracias!');
				} else {
					window.plugins.calendar.createEvent(title,location,"",startDate,endDate,success,error);
				}
			},error);
		});

		$('*[data-mapa]').on('click', function() {
			var i = $(this).attr('data-mapa');
			$('#lemap').attr('src', 'http://maps.googleapis.com/maps/api/staticmap?scale=2&size=640x640&path=weight:5%7Ccolor:0x000000%7Cenc:' + evento[i].ruta + '&sensor=true');
			load('mapa',0)
		});
	}

</script>
</body>
</html>